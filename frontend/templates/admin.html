<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Admin Panel - Jan-Dhan Gateway</title>
    <link rel="stylesheet" href="/static/css/style.css">
</head>
<body>
    <nav class="navbar">
        <div class="container">
            <div class="nav-brand">
                <h1>ğŸ›¡ï¸ Jan-Dhan Gateway</h1>
            </div>
            <ul class="nav-menu">
                <li><a href="/">Dashboard</a></li>
                <li><a href="/transaction">Submit Claim</a></li>
                <li><a href="/admin" class="active">Admin Panel</a></li>
            </ul>
        </div>
    </nav>

    <main class="container">
        <section class="admin-header">
            <h2>ğŸ›ï¸ Admin Control Panel</h2>
            <p>Emergency controls and system monitoring</p>
        </section>

        <!-- Kill-Switch Controls -->
        <section class="kill-switch-section">
            <h3>âš ï¸ Emergency Kill-Switch</h3>
            <div class="control-panel">
                <div class="control-item">
                    <h4>System Status: <span id="adminSystemStatus">Loading...</span></h4>
                    <div class="button-group">
                        <button onclick="pauseSystem()" class="btn btn-warning">
                            â¸ï¸ Pause System
                        </button>
                        <button onclick="activateSystem()" class="btn btn-success">
                            â–¶ï¸ Activate System
                        </button>
                    </div>
                </div>
            </div>
            <div id="adminMessage" class="admin-message" style="display: none;"></div>
        </section>

        <!-- System Monitoring -->
        <section class="monitoring-section">
            <h3>ğŸ“Š System Monitoring</h3>
            <div class="monitor-grid">
                <div class="monitor-card">
                    <h4>Budget Status</h4>
                    <p>Remaining: <span id="adminBudget">--</span></p>
                    <p>Utilized: <span id="adminUtilized">--</span></p>
                </div>
                <div class="monitor-card">
                    <h4>Transactions</h4>
                    <p>Total: <span id="adminTxCount">--</span></p>
                    <p>Disbursed: <span id="adminDisbursed">--</span></p>
                </div>
                <div class="monitor-card">
                    <h4>Ledger Integrity</h4>
                    <p>Status: <span id="adminLedgerStatus">--</span></p>
                    <p>Merkle: <span id="adminMerkle">--</span></p>
                </div>
            </div>
        </section>

        <!-- System Locks -->
        <section class="locks-section">
            <h3>ğŸ”’ Automatic System Locks</h3>
            <div class="lock-info">
                <div class="lock-card">
                    <h4>Budget Exhausted</h4>
                    <p>System auto-freezes when budget reaches â‚¹0</p>
                </div>
                <div class="lock-card">
                    <h4>Ledger Tampering</h4>
                    <p>System freezes if hash chain is broken</p>
                </div>
                <div class="lock-card">
                    <h4>Manual Pause</h4>
                    <p>Admin can manually pause for maintenance</p>
                </div>
            </div>
        </section>
    </main>

    <footer>
        <p>ğŸ” Powered by Blockchain + AI | Jan-Dhan Gateway Â© 2026</p>
    </footer>

    <script>
        async function loadAdminData() {
            try {
                const response = await fetch('/api/system/status');
                const data = await response.json();

                if (data.success) {
                    document.getElementById('adminSystemStatus').textContent = data.system_status;
                    document.getElementById('adminBudget').textContent = 
                        `â‚¹${data.budget.remaining.toLocaleString()}`;
                    document.getElementById('adminUtilized').textContent = 
                        `${data.budget.percentage}%`;
                    document.getElementById('adminTxCount').textContent = 
                        data.transactions.total;
                    document.getElementById('adminDisbursed').textContent = 
                        `â‚¹${data.transactions.total_disbursed.toLocaleString()}`;
                    document.getElementById('adminLedgerStatus').textContent = 
                        data.ledger.is_valid ? 'âœ… Valid' : 'âŒ Corrupted';
                    document.getElementById('adminMerkle').textContent = 
                        data.ledger.merkle_root;
                }
            } catch (error) {
                console.error('Error loading admin data:', error);
            }
        }

        async function pauseSystem() {
            try {
                const response = await fetch('/api/admin/pause', { method: 'POST' });
                const data = await response.json();
                
                showMessage(data.success ? 
                    'âœ… System paused successfully' : 
                    `âŒ Error: ${data.error}`, 
                    data.success ? 'success' : 'error'
                );
                
                loadAdminData();
            } catch (error) {
                showMessage(`âŒ Error: ${error.message}`, 'error');
            }
        }

        async function activateSystem() {
            try {
                const response = await fetch('/api/admin/activate', { method: 'POST' });
                const data = await response.json();
                
                showMessage(data.success ? 
                    'âœ… System activated successfully' : 
                    `âŒ Error: ${data.error}`, 
                    data.success ? 'success' : 'error'
                );
                
                loadAdminData();
            } catch (error) {
                showMessage(`âŒ Error: ${error.message}`, 'error');
            }
        }

        function showMessage(message, type) {
            const msgBox = document.getElementById('adminMessage');
            msgBox.textContent = message;
            msgBox.className = `admin-message admin-message-${type}`;
            msgBox.style.display = 'block';
            
            setTimeout(() => {
                msgBox.style.display = 'none';
            }, 5000);
        }

        // Load data on page load
        loadAdminData();

        // Auto-refresh every 5 seconds
        setInterval(loadAdminData, 5000);
    </script>
</body>
</html>
