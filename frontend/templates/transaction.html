<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Submit Transaction - Jan-Dhan Gateway</title>
    <link rel="stylesheet" href="/static/css/style.css">
</head>
<body>
    <nav class="navbar">
        <div class="container">
            <div class="nav-brand">
                <h1>üõ°Ô∏è Jan-Dhan Gateway</h1>
            </div>
            <ul class="nav-menu">
                <li><a href="/">Dashboard</a></li>
                <li><a href="/transaction" class="active">Submit Claim</a></li>
                <li><a href="/admin">Admin Panel</a></li>
            </ul>
        </div>
    </nav>

    <main class="container">
        <section class="form-section">
            <h2>Submit Benefit Claim</h2>
            <p class="form-description">
                Enter citizen details to process benefit distribution through 
                three-gate validation + AI fraud detection
            </p>

            <form id="transactionForm" class="transaction-form">
                <div class="form-group">
                    <label for="citizenId">Citizen ID (12 digits)*</label>
                    <input type="text" id="citizenId" required 
                           placeholder="e.g., 322651194174" 
                           pattern="[0-9]{12}" 
                           maxlength="12">
                    <small>12-digit unique citizen identifier</small>
                </div>

                <div class="form-group">
                    <label for="scheme">Benefit Scheme*</label>
                    <select id="scheme" required>
                        <option value="">-- Select Scheme --</option>
                        <option value="Pension">Pension (‚Çπ2,000)</option>
                        <option value="Health">Health (‚Çπ5,000)</option>
                        <option value="Food">Food (‚Çπ1,000)</option>
                    </select>
                </div>

                <button type="submit" class="btn btn-primary btn-large">
                    Process Transaction
                </button>
            </form>

            <!-- Result Display -->
            <div id="resultBox" class="result-box" style="display: none;">
                <h3 id="resultTitle"></h3>
                <div id="resultContent"></div>
            </div>
        </section>

        <section class="info-section">
            <h3>üö™ Three-Gate Validation Process</h3>
            <div class="gate-cards">
                <div class="gate-card">
                    <h4>Gate 1: Eligibility</h4>
                    <ul>
                        <li>‚úì Citizen ID exists</li>
                        <li>‚úì Account is Active</li>
                        <li>‚úì Aadhaar linked</li>
                        <li>‚úì Scheme eligibility</li>
                        <li>‚úì Claim count ‚â§ 3</li>
                    </ul>
                </div>
                <div class="gate-card">
                    <h4>Gate 2: Budget</h4>
                    <ul>
                        <li>‚úì Sufficient funds</li>
                        <li>‚úì Budget available</li>
                        <li>‚úì Auto-lock on exhaust</li>
                    </ul>
                </div>
                <div class="gate-card">
                    <h4>Gate 3: Frequency</h4>
                    <ul>
                        <li>‚úì 30 days since last claim</li>
                        <li>‚úì Prevents abuse</li>
                        <li>‚úì Date verification</li>
                    </ul>
                </div>
            </div>
        </section>
    </main>

    <footer>
        <p>üîê Powered by Blockchain + AI | Jan-Dhan Gateway ¬© 2026</p>
    </footer>

    <script>
        document.getElementById('transactionForm').addEventListener('submit', async (e) => {
            e.preventDefault();

            const citizenId = document.getElementById('citizenId').value;
            const scheme = document.getElementById('scheme').value;
            const resultBox = document.getElementById('resultBox');
            const resultTitle = document.getElementById('resultTitle');
            const resultContent = document.getElementById('resultContent');

            // Show loading
            resultBox.style.display = 'block';
            resultBox.className = 'result-box result-loading';
            resultTitle.textContent = '‚è≥ Processing...';
            resultContent.innerHTML = '<p>Running three-gate validation...</p>';

            try {
                const response = await fetch('/api/transaction/submit', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({
                        citizen_id: citizenId,
                        scheme: scheme
                    })
                });

                const data = await response.json();

                if (data.success) {
                    const tx = data.transaction;
                    
                    if (tx.approved) {
                        resultBox.className = 'result-box result-success';
                        resultTitle.textContent = '‚úÖ Transaction Approved';
                        
                        let html = `
                            <p><strong>Citizen ID:</strong> ${tx.citizen_id}</p>
                            <p><strong>Scheme:</strong> ${tx.scheme}</p>
                            <p><strong>Amount:</strong> ‚Çπ${tx.amount.toLocaleString()}</p>
                            <p><strong>Transaction Hash:</strong> ${tx.transaction_hash?.substring(0, 16)}...</p>
                            <h4>Gates Passed:</h4>
                            <ul>
                                ${tx.gates_passed.map(gate => `<li>‚úì ${gate}</li>`).join('')}
                            </ul>
                            <h4>Validation Messages:</h4>
                            <ul>
                                ${tx.messages.map(msg => `<li>${msg}</li>`).join('')}
                            </ul>
                        `;

                        if (data.fraud_analysis) {
                            html += `
                                <h4>AI Fraud Analysis:</h4>
                                <p><strong>Risk Level:</strong> ${data.fraud_analysis.risk_level}</p>
                                <p><strong>Fraud Probability:</strong> ${(data.fraud_analysis.fraud_probability * 100).toFixed(1)}%</p>
                                <p><strong>Recommendation:</strong> ${data.fraud_analysis.recommendation}</p>
                            `;
                        }

                        resultContent.innerHTML = html;
                    } else {
                        resultBox.className = 'result-box result-error';
                        resultTitle.textContent = '‚ùå Transaction Rejected';
                        
                        let html = `
                            <p><strong>Citizen ID:</strong> ${tx.citizen_id}</p>
                            <p><strong>Scheme:</strong> ${tx.scheme}</p>
                            <h4>Failed Gates:</h4>
                            <ul>
                                ${tx.gates_failed.map(gate => `<li>‚ùå ${gate}</li>`).join('')}
                            </ul>
                            <h4>Rejection Reasons:</h4>
                            <ul>
                                ${tx.messages.map(msg => `<li>${msg}</li>`).join('')}
                            </ul>
                        `;
                        resultContent.innerHTML = html;
                    }
                } else {
                    resultBox.className = 'result-box result-error';
                    resultTitle.textContent = '‚ùå Error';
                    resultContent.innerHTML = `<p>${data.error}</p>`;
                }
            } catch (error) {
                resultBox.className = 'result-box result-error';
                resultTitle.textContent = '‚ùå Error';
                resultContent.innerHTML = `<p>Failed to connect to server: ${error.message}</p>`;
            }
        });
    </script>
</body>
</html>
