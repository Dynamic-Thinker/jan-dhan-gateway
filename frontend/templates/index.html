<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Jan-Dhan Gateway - Dashboard</title>
    <link rel="stylesheet" href="/static/css/style.css">
</head>
<body>
    <nav class="navbar">
        <div class="container">
            <div class="nav-brand">
                <h1>ğŸ›¡ï¸ Jan-Dhan Gateway</h1>
                <span class="tagline">Fraud-Proof Benefit Distribution</span>
            </div>
            <ul class="nav-menu">
                <li><a href="/" class="active">Dashboard</a></li>
                <li><a href="/transaction">Submit Claim</a></li>
                <li><a href="/admin">Admin Panel</a></li>
            </ul>
        </div>
    </nav>

    <main class="container">
        <!-- System Status Card -->
        <section class="status-banner" id="statusBanner">
            <div class="status-indicator">
                <span class="status-dot" id="statusDot"></span>
                <h2>System Status: <span id="systemStatus">Loading...</span></h2>
            </div>
            <p class="status-time" id="lastUpdate">Last updated: --</p>
        </section>

        <!-- Key Metrics -->
        <section class="metrics-grid">
            <div class="metric-card">
                <div class="metric-icon">ğŸ’°</div>
                <div class="metric-content">
                    <h3>Budget Remaining</h3>
                    <p class="metric-value" id="budgetRemaining">â‚¹--</p>
                    <small id="budgetPercentage">--%</small>
                </div>
            </div>

            <div class="metric-card">
                <div class="metric-icon">ğŸ“Š</div>
                <div class="metric-content">
                    <h3>Total Transactions</h3>
                    <p class="metric-value" id="totalTransactions">--</p>
                    <small>Processed</small>
                </div>
            </div>

            <div class="metric-card">
                <div class="metric-icon">ğŸ’¸</div>
                <div class="metric-content">
                    <h3>Total Disbursed</h3>
                    <p class="metric-value" id="totalDisbursed">â‚¹--</p>
                    <small>Allocated</small>
                </div>
            </div>

            <div class="metric-card">
                <div class="metric-icon">ğŸ”</div>
                <div class="metric-content">
                    <h3>Ledger Integrity</h3>
                    <p class="metric-value" id="ledgerStatus">--</p>
                    <small id="merkleRoot">Merkle: --</small>
                </div>
            </div>
        </section>

        <!-- Budget Progress Bar -->
        <section class="progress-section">
            <h3>Budget Utilization</h3>
            <div class="progress-bar">
                <div class="progress-fill" id="progressFill" style="width: 0%"></div>
            </div>
            <div class="progress-labels">
                <span>â‚¹0</span>
                <span id="progressLabel">0% Used</span>
                <span>â‚¹10,00,000</span>
            </div>
        </section>

        <!-- Features Highlight -->
        <section class="features-section">
            <h2>ğŸ† Fraud Prevention Features</h2>
            <div class="features-grid">
                <div class="feature-card">
                    <h4>ğŸ”’ SHA-256 Hashing</h4>
                    <p>Citizen IDs hashed for privacy protection</p>
                </div>
                <div class="feature-card">
                    <h4>ğŸ”— Blockchain Ledger</h4>
                    <p>Immutable hash-chain prevents tampering</p>
                </div>
                <div class="feature-card">
                    <h4>ğŸšª Three-Gate Validation</h4>
                    <p>Eligibility, Budget, Frequency checks</p>
                </div>
                <div class="feature-card">
                    <h4>ğŸ¤– AI Fraud Detection</h4>
                    <p>Machine learning pattern analysis</p>
                </div>
                <div class="feature-card">
                    <h4>ğŸŒ³ Merkle Tree</h4>
                    <p>Advanced cryptographic verification</p>
                </div>
                <div class="feature-card">
                    <h4>âš¡ Auto-Lock System</h4>
                    <p>Budget exhaustion triggers freeze</p>
                </div>
            </div>
        </section>

        <!-- Quick Actions -->
        <section class="actions-section">
            <h2>Quick Actions</h2>
            <div class="button-group">
                <a href="/transaction" class="btn btn-primary">Submit New Claim</a>
                <button onclick="refreshData()" class="btn btn-secondary">Refresh Data</button>
                <a href="/admin" class="btn btn-outline">Admin Controls</a>
            </div>
        </section>
    </main>

    <footer>
        <p>ğŸ” Powered by Blockchain + AI | Jan-Dhan Gateway Â© 2026</p>
    </footer>

    <script>
        // Auto-refresh data every 5 seconds
        let refreshInterval;

        async function loadDashboard() {
            try {
                const response = await fetch('/api/system/status');
                const data = await response.json();

                if (data.success) {
                    // Update system status
                    const status = data.system_status;
                    document.getElementById('systemStatus').textContent = status;
                    document.getElementById('lastUpdate').textContent = 
                        `Last updated: ${data.timestamp}`;

                    const statusDot = document.getElementById('statusDot');
                    const statusBanner = document.getElementById('statusBanner');
                    
                    statusBanner.className = 'status-banner';
                    if (status === 'Active') {
                        statusBanner.classList.add('status-active');
                    } else if (status === 'Paused') {
                        statusBanner.classList.add('status-paused');
                    } else {
                        statusBanner.classList.add('status-frozen');
                    }

                    // Update metrics
                    document.getElementById('budgetRemaining').textContent = 
                        `â‚¹${data.budget.remaining.toLocaleString()}`;
                    document.getElementById('budgetPercentage').textContent = 
                        `${data.budget.percentage}% utilized`;
                    document.getElementById('totalTransactions').textContent = 
                        data.transactions.total;
                    document.getElementById('totalDisbursed').textContent = 
                        `â‚¹${data.transactions.total_disbursed.toLocaleString()}`;
                    
                    // Update ledger status
                    document.getElementById('ledgerStatus').textContent = 
                        data.ledger.is_valid ? 'âœ… Valid' : 'âŒ Corrupted';
                    document.getElementById('merkleRoot').textContent = 
                        `Merkle: ${data.ledger.merkle_root}`;

                    // Update progress bar
                    const percentage = data.budget.percentage;
                    document.getElementById('progressFill').style.width = `${percentage}%`;
                    document.getElementById('progressLabel').textContent = 
                        `${percentage}% Used`;
                }
            } catch (error) {
                console.error('Error loading dashboard:', error);
            }
        }

        function refreshData() {
            loadDashboard();
        }

        // Load on page load
        loadDashboard();

        // Auto-refresh every 5 seconds
        refreshInterval = setInterval(loadDashboard, 5000);
    </script>
</body>
</html>
